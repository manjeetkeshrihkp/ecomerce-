<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>STRINK BILLING</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        /* Basic Reset */
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Arial', sans-serif; }

        body { 
            background-color: #111111; 
            color: #ffffff; 
            padding: 20px; 
            padding-top: 100px; 
            overflow-x: hidden; 
        }

        /* FIXED HEADER */
        .header {
            display: flex; justify-content: space-between; align-items: center;
            position: fixed; top: 0; left: 0; width: 100%; min-height: 80px;
            background-color: rgba(17, 17, 17, 0.95); backdrop-filter: blur(10px);
            z-index: 1000; padding: 10px 20px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.5); border-bottom: 1px solid #222;
        }

        .logo { color: #e6f014; font-weight: 900; font-size: 24px; letter-spacing: 1px; flex-shrink: 0; white-space: nowrap; }

        .search-bar {
            display: flex; align-items: center; background-color: #1a1a1a;
            padding: 12px 20px; border-radius: 12px; flex-grow: 1; margin: 0 15px; border: 1px solid #333;
        }
        .search-bar i { color: #888; margin-right: 10px; }
        .search-bar input { background: none; border: none; color: #fff; font-size: 16px; width: 100%; outline: none; }

        /* PROFILE BUTTON STYLES */
        .profile-btn {
            background-color: #1a1a1a; 
            border: none; 
            color: #fff; 
            border-radius: 12px;
            cursor: pointer; 
            transition: background 0.3s;
            flex-shrink: 0; 
            width: 50px; 
            height: 50px; 
            display: flex; 
            justify-content: center; 
            align-items: center;
            margin-right: 10px; 
        }
        .profile-btn:hover { background-color: #333; }

        .cart-btn {
            background-color: #1a1a1a; border: none; color: #fff; border-radius: 12px;
            cursor: pointer; position: relative; z-index: 10; transition: background 0.3s;
            flex-shrink: 0; width: 50px; height: 50px; display: flex; justify-content: center; align-items: center;
        }
        .cart-btn:hover { background-color: #333; }
        .cart-count {
            position: absolute; top: -5px; right: -5px; background-color: #e6f014;
            color: #000; font-size: 10px; font-weight: bold; padding: 4px 6px; border-radius: 50%; display: none;
        }

        /* CART SIDEBAR */
        .cart-overlay { 
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: rgba(0,0,0,0.5); z-index: 1100; display: none; backdrop-filter: blur(2px); 
        }
        .cart-sidebar { 
            position: fixed; top: 0; right: -400px; width: 100%; max-width: 400px; height: 100%; 
            background-color: #1a1a1a; z-index: 1200; padding: 20px; display: flex; flex-direction: column; 
            transition: right 0.3s ease-in-out; box-shadow: -5px 0 15px rgba(0,0,0,0.5); 
        }
        .cart-sidebar.open { right: 0; }
        .cart-overlay.open { display: block; }
        .cart-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; border-bottom: 1px solid #333; padding-bottom: 15px; }
        .close-cart { background: none; border: none; color: #fff; font-size: 24px; cursor: pointer; }
        .cart-items { flex-grow: 1; overflow-y: auto; }
        .empty-cart-msg { text-align: center; color: #888; margin-top: 50px; }
        .cart-item { display: flex; align-items: center; margin-bottom: 15px; padding-bottom: 15px; border-bottom: 1px solid #2a2a2a; }
        .cart-item-img { width: 60px; height: 60px; border-radius: 10px; object-fit: cover; margin-right: 15px; }
        .cart-item-details { flex-grow: 1; }
        .cart-item-title { font-size: 14px; font-weight: bold; margin-bottom: 5px; }
        .cart-item-price { color: #e6f014; font-size: 13px; }
        .remove-btn { color: #ff4444; cursor: pointer; font-size: 12px; margin-left: 10px; }
        .cart-footer { padding-top: 20px; border-top: 1px solid #333; }
        .total-row { display: flex; justify-content: space-between; font-size: 18px; font-weight: bold; margin-bottom: 20px; }
        .checkout-btn { width: 100%; padding: 15px; background-color: #e6f014; color: #000; font-weight: 900; border: none; border-radius: 12px; cursor: pointer; font-size: 16px; letter-spacing: 1px; transition: transform 0.2s; }
        .checkout-btn:hover { background-color: #d4dd12; }
        .checkout-btn:active { transform: scale(0.98); }

        /* CHECKOUT MODAL */
        .checkout-modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: #111; z-index: 2500; display: none;
            overflow-y: auto; padding: 20px;
        }
        .checkout-modal.open { display: block; }

        .checkout-container { max-width: 600px; margin: 80px auto 0; background: #1a1a1a; padding: 20px; border-radius: 20px; border: 1px solid #333; }
        .checkout-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; border-bottom: 1px solid #333; padding-bottom: 15px; }
        .checkout-header h2 { color: #e6f014; }

        /* Clear Data Button */
        .clear-data-container { display: flex; justify-content: flex-end; align-items: center; margin-bottom: 15px; }
        .clear-data-btn {
            background: transparent; border: 1px solid #ff4444; color: #ff4444;
            padding: 5px 10px; border-radius: 5px; font-size: 12px; cursor: pointer;
        }
        .clear-data-btn:hover { background: #ff4444; color: white; }

        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 5px; font-size: 14px; color: #ccc; }
        .form-group input, .form-group textarea, .form-group select { 
            width: 100%; padding: 12px; background: #222; border: 1px solid #333; color: #fff; border-radius: 8px; outline: none; 
        }
        .form-group input:focus, .form-group select:focus { border-color: #e6f014; }

        .bill-summary { background: #222; padding: 15px; border-radius: 12px; margin: 20px 0; }
        .bill-row { display: flex; justify-content: space-between; margin-bottom: 10px; font-size: 14px; color: #ccc; }
        .bill-row.total { border-top: 1px solid #333; padding-top: 10px; font-size: 18px; font-weight: bold; color: #fff; }
        .bill-row.total span:last-child { color: #e6f014; }

        .delivery-note {
            background-color: rgba(230, 240, 20, 0.1); border: 1px solid #e6f014; 
            color: #e6f014; padding: 15px; border-radius: 12px; font-size: 13px; 
            line-height: 1.5; margin-bottom: 20px; display: flex; gap: 10px;
        }
        .delivery-note i { font-size: 18px; margin-top: 2px; }

        .place-order-btn { width: 100%; padding: 15px; background-color: #e6f014; color: #000; font-weight: 900; border: none; border-radius: 12px; cursor: pointer; font-size: 16px; transition: transform 0.2s; }
        .place-order-btn:hover { background-color: #d4dd12; }

        /* PAYMENT STEP STYLES */
        .payment-options { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 30px 0; }
        .payment-card { 
            background: #222; border: 1px solid #333; padding: 30px 20px; 
            border-radius: 15px; text-align: center; cursor: pointer; transition: all 0.3s;
        }
        .payment-card:hover { border-color: #e6f014; box-shadow: 0 0 15px rgba(230, 240, 20, 0.2); transform: translateY(-3px); }
        .pay-icon { font-size: 40px; color: #e6f014; margin-bottom: 15px; }
        .payment-card h4 { font-size: 18px; margin-bottom: 5px; }
        .payment-card p { font-size: 12px; color: #888; }

        .payment-total-preview { text-align: center; font-size: 18px; margin-bottom: 20px; color: #ccc; }
        .back-btn { 
            width: 100%; padding: 12px; background: transparent; border: 1px solid #333; color: #888; 
            border-radius: 10px; cursor: pointer; margin-top: 10px;
        }
        .back-btn:hover { color: #fff; border-color: #fff; }

        /* QR PAYMENT STYLES */
        .qr-container { background: #fff; padding: 20px; border-radius: 20px; display: inline-block; margin-bottom: 20px; }
        .qr-container img { width: 200px; height: 200px; object-fit: contain; }
        .timer-box { font-size: 32px; font-weight: bold; color: #ff4444; margin-bottom: 20px; letter-spacing: 2px; }

        /* ADVANCED PAYMENT LOADER */
        .payment-loader {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(0, 0, 0, 0.95); z-index: 3000; display: none;
            flex-direction: column; justify-content: center; align-items: center;
        }
        .loader-content { text-align: center; color: #fff; position: relative; }
        .pulse-container { position: relative; width: 140px; height: 140px; margin: 0 auto 40px; display: flex; justify-content: center; align-items: center; }
        .logo-text { font-size: 22px; font-weight: 900; color: #e6f014; z-index: 10; letter-spacing: 1px; }
        .pulse-ring {
            position: absolute; width: 100%; height: 100%; border-radius: 50%;
            border: 3px solid #e6f014; opacity: 0;
            animation: pulse 2.5s infinite ease-out;
        }
        .pulse-ring.delay { animation-delay: 0.8s; }
        @keyframes pulse { 0% { transform: scale(0.5); opacity: 1; } 100% { transform: scale(2.2); opacity: 0; } }
        .loader-content h3 { color: #fff; margin-bottom: 12px; font-size: 22px; font-weight: normal; letter-spacing: 1px; }
        .loader-content p { color: #888; font-size: 15px; }

        /* INFO TOOLTIP */
        .tooltip-container { position: absolute; right: 10px; top: 12px; cursor: pointer; }
        .info-icon { color: #888; font-size: 18px; }
        .tooltip-text { 
            visibility: hidden; width: 200px; background-color: #333; color: #fff; 
            text-align: left; border-radius: 6px; padding: 10px; position: absolute; 
            z-index: 1; bottom: 125%; left: 50%; margin-left: -180px; font-size: 12px; border: 1px solid #555;
        }
        .tooltip-container:hover .tooltip-text { visibility: visible; }

        /* ORDER SUCCESS SCREEN */
        .order-success-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: #111; z-index: 3500; display: none;
            justify-content: center; align-items: center; overflow-y: auto;
        }
        .success-card { text-align: center; padding: 30px; width: 90%; max-width: 450px; }
        .success-icon { margin-bottom: 20px; }
        .checkmark { width: 80px; height: 80px; border-radius: 50%; display: block; stroke-width: 2; stroke: #e6f014; stroke-miterlimit: 10; margin: 10% auto; box-shadow: inset 0px 0px 0px #e6f014; animation: fill .4s ease-in-out .4s forwards, scale .3s ease-in-out .9s both; }
        .checkmark-circle { stroke-dasharray: 166; stroke-dashoffset: 166; stroke-width: 2; stroke-miterlimit: 10; stroke: #e6f014; fill: none; animation: stroke 0.6s cubic-bezier(0.65, 0, 0.45, 1) forwards; }
        .checkmark-check { transform-origin: 50% 50%; stroke-dasharray: 48; stroke-dashoffset: 48; animation: stroke 0.3s cubic-bezier(0.65, 0, 0.45, 1) 0.8s forwards; }
        @keyframes stroke { 100% { stroke-dashoffset: 0; } }
        @keyframes scale { 0%, 100% { transform: none; } 50% { transform: scale3d(1.1, 1.1, 1); } }
        @keyframes fill { 100% { box-shadow: inset 0px 0px 0px 50px transparent; } }

        .success-card h2 { font-size: 28px; color: #fff; margin-bottom: 5px; }
        .success-quote { color: #e6f014; font-style: italic; margin-bottom: 15px; font-size: 14px; }
        .order-id-box { background: #222; padding: 10px; border-radius: 8px; margin-bottom: 15px; color: #ccc; font-weight: bold; border: 1px dashed #333; }
        .delivery-msg { color: #4caf50; font-size: 14px; margin-bottom: 20px; font-weight: bold; }

        /* On Screen Bill */
        .on-screen-bill { background: #222; padding: 15px; border-radius: 12px; margin-bottom: 20px; text-align: left; }
        .on-screen-bill h4 { border-bottom: 1px solid #333; padding-bottom: 8px; margin-bottom: 8px; color: #ccc; font-size: 14px; }
        .os-item-row { display: flex; justify-content: space-between; font-size: 13px; color: #888; margin-bottom: 5px; }
        .bill-total-row { display: flex; justify-content: space-between; font-weight: bold; font-size: 16px; margin-top: 10px; border-top: 1px solid #333; padding-top: 10px; color: #e6f014; }

        .download-btn { width: 100%; padding: 15px; background: #fff; color: #000; border: none; border-radius: 12px; font-weight: bold; cursor: pointer; margin-bottom: 10px; display: flex; align-items: center; justify-content: center; gap: 10px; }
        .continue-btn { width: 100%; padding: 15px; background: transparent; border: 1px solid #333; color: #fff; border-radius: 12px; cursor: pointer; }

        /* ALL CATEGORIES MODAL */
        .all-categories-modal { 
            position: fixed; top: 100%; left: 0; width: 100%; height: 100%; background-color: #000; 
            z-index: 2000; padding: 30px 20px; padding-top: 100px; transition: top 0.4s ease-in-out; 
            display: flex; flex-direction: column; 
        }
        .all-categories-modal.open { top: 0; }
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .modal-header h2 { font-size: 24px; color: #e6f014; }
        .close-modal { background: none; border: none; color: #fff; font-size: 32px; cursor: pointer; }
        .all-cats-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; overflow-y: auto; padding-bottom: 50px; -ms-overflow-style: none; scrollbar-width: none; }
        .all-cats-grid::-webkit-scrollbar { display: none; }

        /* SLIDER */
        .hero-slider { position: relative; width: 100%; height: 350px; border-radius: 30px; overflow: hidden; margin-bottom: 20px; }
        .slides-container { width: 100%; height: 100%; position: relative; }
        .slide { display: none; position: absolute; width: 100%; height: 100%; top: 0; left: 0; }
        .slide.active { display: block; animation: fadeEffect 1s; }
        @keyframes fadeEffect { from {opacity: 0.4} to {opacity: 1} }
        .slide img { width: 100%; height: 100%; object-fit: cover; filter: brightness(0.6); }
        .hero-content { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center; width: 100%; z-index: 2; }
        .hero-subtitle { color: #e6f014; font-size: 12px; font-weight: bold; letter-spacing: 2px; margin-bottom: 10px; }
        .hero-title { font-size: 48px; font-weight: 900; margin-bottom: 10px; text-shadow: 2px 2px 4px rgba(0,0,0,0.5); }
        .hero-description { font-size: 14px; letter-spacing: 1px; color: #ccc; }
        .slider-dots { position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%); display: flex; gap: 10px; z-index: 3; }
        .dot { cursor: pointer; height: 8px; width: 8px; background-color: #888; border-radius: 50%; transition: background-color 0.6s ease; }
        .dot.active { background-color: #e6f014; }

        /* CIRCLE MENU */
        .circle-menu-section { position: relative; margin-bottom: 30px; display: flex; align-items: center; }
        .circle-container { display: flex; gap: 20px; overflow-x: auto; padding: 10px 5px; scroll-behavior: smooth; -ms-overflow-style: none; scrollbar-width: none; }
        .circle-container::-webkit-scrollbar { display: none; }
        .circle-item { display: flex; flex-direction: column; align-items: center; min-width: 80px; cursor: pointer; transition: transform 0.2s; }
        .circle-item:hover { transform: scale(1.05); }
        .circle-img-box { width: 80px; height: 80px; border-radius: 50%; padding: 3px; background: linear-gradient(45deg, #e6f014, #fff); margin-bottom: 8px; display: flex; justify-content: center; align-items: center; overflow: hidden; }
        .circle-img-box img { width: 100%; height: 100%; border-radius: 50%; object-fit: cover; border: 3px solid #111; }
        .circle-item p { font-size: 12px; font-weight: bold; color: #ccc; text-align: center; }
        .circle-item:hover p { color: #fff; }
        .view-all-circle { background: #333; border: 2px solid #555; }
        .view-all-circle i { font-size: 24px; color: #e6f014; }
        .scroll-arrow { background: rgba(0,0,0,0.8); border: 1px solid #333; color: #fff; width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; z-index: 5; flex-shrink: 0; }
        .scroll-arrow.left { margin-right: 10px; }
        .scroll-arrow.right { margin-left: 10px; }

        /* GRID */
        .categories { display: flex; gap: 15px; margin-bottom: 30px; overflow-x: auto; -ms-overflow-style: none; scrollbar-width: none; }
        .categories::-webkit-scrollbar { display: none; }
        .cat-btn { display: flex; align-items: center; padding: 12px 25px; border-radius: 30px; border: none; font-size: 14px; font-weight: bold; cursor: pointer; background-color: #1a1a1a; color: #fff; transition: all 0.3s ease; white-space: nowrap; }
        .cat-btn.active { background-color: #e6f014; color: #000; box-shadow: 0 0 15px rgba(230, 240, 20, 0.4); }
        .product-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; }
        .product-card { background-color: transparent; border-radius: 20px; overflow: hidden; }
        .product-card.hidden { display: none; }
        .hide-on-search { display: none !important; }
        .product-image-container { position: relative; width: 100%; padding-top: 120%; border-radius: 20px; overflow: hidden; margin-bottom: 15px; }
        .product-img { position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; }
        .discount-tag { position: absolute; top: 15px; left: 15px; background-color: #e6f014; color: #000; padding: 5px 10px; border-radius: 20px; font-size: 12px; font-weight: bold; z-index: 1; }
        .product-info { padding: 0 5px; }
        .product-title { font-size: 16px; font-weight: bold; margin-bottom: 10px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .product-footer { display: flex; justify-content: space-between; align-items: center; }
        .price-container { display: flex; flex-direction: column; }
        .current-price { font-size: 18px; font-weight: bold; }
        .original-price { font-size: 14px; color: #888; text-decoration: line-through; }
        .add-to-cart-btn { background-color: #e6f014; color: #000; border: none; width: 40px; height: 40px; border-radius: 12px; font-size: 20px; cursor: pointer; display: flex; justify-content: center; align-items: center; transition: transform 0.1s; }
        .add-to-cart-btn:active { transform: scale(0.9); }
        .toast { visibility: hidden; min-width: 250px; background-color: #333; color: #fff; text-align: center; border-radius: 30px; padding: 16px; position: fixed; z-index: 100; left: 50%; bottom: 30px; transform: translateX(-50%); font-size: 14px; box-shadow: 0 5px 15px rgba(0,0,0,0.5); border: 1px solid #e6f014; }
        .toast.show { visibility: visible; animation: fadein 0.5s, fadeout 0.5s 2.5s; }
        @keyframes fadein { from {bottom: 0; opacity: 0;} to {bottom: 30px; opacity: 1;} }
        @keyframes fadeout { from {bottom: 30px; opacity: 1;} to {bottom: 0; opacity: 0;} }

        /* --- HIDDEN INVOICE & PRINT STYLES --- */
        .printable-invoice { display: none; }

        @media print {
            body > * { display: none !important; }
            #printable-invoice { display: block !important; position: absolute; top: 0; left: 0; width: 100%; background: #fff; color: #000; padding: 40px; font-family: 'Arial', sans-serif; }
            .invoice-header { text-align: center; border-bottom: 2px solid #000; padding-bottom: 20px; margin-bottom: 30px; }
            .invoice-header h1 { font-size: 40px; margin: 0; letter-spacing: 5px; }
            .invoice-details { display: flex; justify-content: space-between; margin-bottom: 30px; font-size: 14px; line-height: 1.6; }
            .invoice-table { width: 100%; border-collapse: collapse; margin-bottom: 30px; }
            .invoice-table th { text-align: left; border-bottom: 1px solid #000; padding: 10px 0; }
            .invoice-table td { padding: 10px 0; border-bottom: 1px solid #eee; }
            .invoice-footer { text-align: right; }
            .inv-row { display: flex; justify-content: space-between; max-width: 250px; margin-left: auto; padding: 5px 0; }
            .inv-row.total { border-top: 2px solid #000; font-weight: bold; font-size: 18px; margin-top: 10px; padding-top: 10px; }
            .invoice-note { text-align: center; margin-top: 50px; font-size: 12px; color: #555; }
        }

        /* --- PROFILE MENU STYLES --- */
        .profile-modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(0, 0, 0, 0.8); z-index: 2600; display: none;
            backdrop-filter: blur(5px);
        }
        .profile-modal.open { display: flex; justify-content: flex-end; }

        .profile-content {
            background-color: #1a1a1a; width: 100%; max-width: 450px; height: 100%;
            padding: 20px; overflow-y: auto; border-left: 1px solid #333;
            animation: slideInRight 0.3s ease-out;
        }
        @keyframes slideInRight { from { transform: translateX(100%); } to { transform: translateX(0); } }

        .profile-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; border-bottom: 1px solid #333; padding-bottom: 15px; }
        .profile-header h2 { color: #e6f014; font-size: 24px; }

        /* User Summary Card */
        .user-summary-card {
            display: flex; align-items: center; background: #222; padding: 20px;
            border-radius: 12px; margin-bottom: 30px; border: 1px solid #333;
        }
        .user-avatar { 
            width: 60px; height: 60px; background: #333; border-radius: 50%; 
            display: flex; justify-content: center; align-items: center; 
            font-size: 24px; color: #e6f014; margin-right: 15px; border: 1px solid #444;
        }
        .user-text h3 { font-size: 18px; margin-bottom: 5px; color: #fff; }
        .user-text p { color: #888; font-size: 14px; }

        /* Menu List */
        .menu-list { display: flex; flex-direction: column; gap: 10px; }
        .menu-item {
            background: transparent; border: none; display: flex; align-items: center; justify-content: space-between;
            padding: 15px; width: 100%; color: #ccc; font-size: 16px; cursor: pointer;
            border-radius: 8px; transition: background 0.2s; text-decoration: none;
        }
        .menu-item:hover { background: #222; color: #fff; }
        .menu-label { display: flex; align-items: center; gap: 15px; }
        .menu-label i { width: 20px; text-align: center; color: #888; }
        .menu-item:hover .menu-label i { color: #e6f014; }
        .arrow { font-size: 12px; color: #555; }

        .menu-divider { height: 1px; background: #333; margin: 20px 0; }

        .back-icon-btn { background: none; border: none; color: #fff; font-size: 20px; cursor: pointer; }
        .back-icon-btn:hover { color: #e6f014; }

        .profile-section { background: #222; padding: 20px; border-radius: 12px; margin-bottom: 25px; border: 1px solid #333; }

        .danger-zone { display: flex; flex-direction: column; gap: 10px; margin-top: 30px; padding-top: 20px; border-top: 1px solid #333; }
        .danger-btn { width: 100%; padding: 12px; border-radius: 8px; cursor: pointer; font-weight: bold; font-size: 14px; }
        .danger-btn.outline { background: transparent; border: 1px solid #ff4444; color: #ff4444; }
        .danger-btn.outline:hover { background: rgba(255, 68, 68, 0.1); }
        .danger-btn.solid { background: #ff4444; border: none; color: #fff; }
        .danger-btn.solid:hover { background: #cc0000; }

        /* MOBILE LAYOUT ADJUSTMENTS */
        @media (max-width: 600px) { 
            body { padding-top: 140px; } 
            .header { flex-wrap: wrap; padding: 15px; } 
            .logo { order: 1; } 
            /* Order 2 puts Profile and Cart next to logo on top row */
            .profile-btn { order: 2; margin-left: auto; margin-right: 10px; } 
            .cart-btn { order: 3; } 
            .search-bar { order: 4; width: 100%; margin: 15px 0 0 0; } 
            .hero-title { font-size: 36px; } 
            .scroll-arrow { display: none; } 
            .all-cats-grid { grid-template-columns: repeat(3, 1fr); gap: 15px; } 
        }

        /* --- MODERN ORDER HISTORY STYLES --- */

        .orders-list-container { padding-bottom: 20px; }

        /* Individual Order Card */
        .history-card {
            background: #222; border: 1px solid #333; border-radius: 16px;
            padding: 20px; margin-bottom: 20px; transition: all 0.3s ease;
            position: relative; overflow: hidden;
        }
        .history-card:hover { border-color: #555; transform: translateY(-2px); box-shadow: 0 10px 20px rgba(0,0,0,0.5); }

        /* Header: Order ID and Status */
        .history-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; padding-bottom: 15px; border-bottom: 1px dashed #333; }
        .history-id { color: #fff; font-weight: bold; font-size: 16px; letter-spacing: 0.5px; }

        /* Status Styles */
        .live-status-container { display: flex; align-items: center; gap: 10px; }
        .status-text { font-size: 12px; font-weight: bold; text-transform: uppercase; letter-spacing: 1px; color: #e6f014; }
        .status-text.delivered { color: #4caf50; }
        .pulse-dot {
            width: 8px; height: 8px; background-color: #e6f014; border-radius: 50%;
            box-shadow: 0 0 0 0 rgba(230, 240, 20, 0.7); animation: pulse-yellow 2s infinite;
        }
        @keyframes pulse-yellow {
            0% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(230, 240, 20, 0.7); }
            70% { transform: scale(1); box-shadow: 0 0 0 6px rgba(230, 240, 20, 0); }
            100% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(230, 240, 20, 0); }
        }
        .delivered-icon { font-size: 14px; color: #4caf50; }

        /* Content: Image Thumbnails */
        .history-content { display: flex; align-items: center; gap: 15px; margin-bottom: 15px; }
        .history-imgs { display: flex; gap: 8px; }
        .h-thumb { width: 50px; height: 50px; border-radius: 10px; object-fit: cover; border: 1px solid #444; }
        .more-items-badge { width: 50px; height: 50px; border-radius: 10px; background: #333; color: #ccc; display: flex; align-items: center; justify-content: center; font-size: 12px; font-weight: bold; border: 1px solid #444; }

        /* Item Text Summary */
        .history-text-summary { color: #888; font-size: 13px; line-height: 1.4; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }

        /* Footer: Date and Price */
        .history-footer { display: flex; justify-content: space-between; align-items: center; margin-top: 10px; }
        .history-date { color: #666; font-size: 12px; display: flex; align-items: center; gap: 6px; }
        .history-total { color: #fff; font-size: 18px; font-weight: bold; }
        .history-total span { color: #e6f014; }

        /* Empty State */
        .empty-history { text-align: center; margin-top: 60px; color: #666; }
        .empty-history i { font-size: 40px; margin-bottom: 15px; color: #333; }

        /* WHATSAPP GLOW BUTTON */
        .whatsapp-glow-btn {
            display: flex; align-items: center; justify-content: center; gap: 10px;
            width: 100%; padding: 15px; margin-bottom: 15px;
            background-color: #25D366; color: white; text-decoration: none;
            font-weight: 900; font-size: 14px; border-radius: 12px;
            box-shadow: 0 0 10px rgba(37, 211, 102, 0.5);
            animation: wa-glow 2s infinite ease-in-out;
        }
        @keyframes wa-glow {
            0% { box-shadow: 0 0 5px rgba(37, 211, 102, 0.4); }
            50% { box-shadow: 0 0 20px rgba(37, 211, 102, 0.8); }
            100% { box-shadow: 0 0 5px rgba(37, 211, 102, 0.4); }
        }

        /* PROFESSIONAL PRINT INVOICE */
        @media print {
            body > * { display: none !important; }
            #printable-invoice { 
                display: block !important; position: absolute; top: 0; left: 0; width: 100%; 
                background: #fff; color: #000; padding: 40px; font-family: 'Helvetica', sans-serif;
            }
            .invoice-header { display: flex; justify-content: space-between; border-bottom: 4px solid #000; padding-bottom: 20px; }
            .invoice-header h1 { font-size: 50px; font-weight: 900; }
            .invoice-details { display: flex; justify-content: space-between; margin: 40px 0; line-height: 1.8; }
            .invoice-table { width: 100%; border-collapse: collapse; margin-bottom: 40px; }
            .invoice-table th { text-align: left; padding: 15px; border-bottom: 2px solid #000; background: #f9f9f9; }
            .invoice-table td { padding: 15px; border-bottom: 1px solid #eee; }
            .invoice-footer { display: flex; flex-direction: column; align-items: flex-end; }
            .inv-row { width: 250px; display: flex; justify-content: space-between; padding: 5px 0; }
            .inv-row.total { border-top: 2px solid #000; padding-top: 15px; font-weight: 900; font-size: 20px; }
        }
    </style>
</head>
<body>

    <header class="header">
        <div class="logo">STRINK...</div>
        <div class="search-bar">
            <i class="fas fa-search"></i>
            <input type="text" id="search-input" placeholder="Search vibe (e.g. Hoodie, 'clean')">
        </div>

        <button class="profile-btn" onclick="openProfile()">
            <i class="fas fa-user"></i>
        </button>

        <button class="cart-btn" onclick="openCart()">
            <i class="fas fa-shopping-bag"></i>
            <span id="cart-count" class="cart-count">0</span>
        </button>
    </header>

    <div class="cart-overlay" id="cart-overlay" onclick="closeCart()"></div>
    <div class="cart-sidebar" id="cart-sidebar">
        <div class="cart-header">
            <h2>Your Bag</h2>
            <button class="close-cart" onclick="closeCart()">&times;</button>
        </div>
        <div class="cart-items" id="cart-items">
            <p class="empty-cart-msg">Your bag is empty.</p>
        </div>
        <div class="cart-footer">
            <div class="total-row">
                <span>Item Total</span>
                <span id="cart-total">₹0</span>
            </div>
            <p style="text-align:center; font-size:12px; color:#888; margin-bottom:10px;">(Final total calculated at checkout)</p>
            <button class="checkout-btn" onclick="openCheckoutModal()">CHECKOUT</button>
        </div>
    </div>

    <div id="profile-modal" class="profile-modal">
        <div class="profile-content">
            
            <div id="profile-main-menu">
                <div class="profile-header">
                    <h2>My Account</h2>
                    <button class="close-modal" onclick="closeProfile()">&times;</button>
                </div>

                <div class="user-summary-card">
                    <div class="user-avatar"><i class="fas fa-user"></i></div>
                    <div class="user-text">
                        <h3 id="menu-user-name">Guest User</h3>
                        <p id="menu-user-phone">No details saved</p>
                    </div>
                </div>

                <div class="menu-list">
                    <button class="menu-item" onclick="showEditView()">
                        <div class="menu-label"><i class="fas fa-user-edit"></i> Edit Profile</div>
                        <i class="fas fa-chevron-right arrow"></i>
                    </button>
                    
                    <button class="menu-item" onclick="showOrdersView()">
                        <div class="menu-label"><i class="fas fa-history"></i> Order History</div>
                        <i class="fas fa-chevron-right arrow"></i>
                    </button>
                </div>

                <div class="menu-divider"></div>

                <div class="menu-list">
                    <a href="contact.html" class="menu-item">
                        <div class="menu-label"><i class="fas fa-envelope"></i> Contact Us</div>
                        <i class="fas fa-chevron-right arrow"></i>
                    </a>
                    <a href="privacy.html" class="menu-item">
                        <div class="menu-label"><i class="fas fa-shield-alt"></i> Privacy Policy</div>
                        <i class="fas fa-chevron-right arrow"></i>
                    </a>
                    <a href="refund.html" class="menu-item">
                        <div class="menu-label"><i class="fas fa-undo"></i> Refund Policy</div>
                        <i class="fas fa-chevron-right arrow"></i>
                    </a>
                    <a href="terms.html" class="menu-item">
                        <div class="menu-label"><i class="fas fa-file-contract"></i> Terms & Conditions</div>
                        <i class="fas fa-chevron-right arrow"></i>
                    </a>
                    <a href="shipping.html" class="menu-item">
                        <div class="menu-label"><i class="fas fa-truck"></i> Shipping Policy</div>
                        <i class="fas fa-chevron-right arrow"></i>
                    </a>
                </div>

                <div class="danger-zone">
                    <button class="danger-btn outline" onclick="clearProfileData()">Sign Out</button>
                </div>
            </div>

            <div id="profile-edit-view" style="display: none;">
                <div class="profile-header">
                    <button class="back-icon-btn" onclick="showMainView()"><i class="fas fa-arrow-left"></i></button>
                    <h2>Edit Profile</h2>
                    <div style="width: 32px;"></div>
                </div>

                <div class="profile-section">
                    <p style="color: #888; font-size: 12px; margin-bottom: 20px;">Update your details below. These will be auto-filled during checkout.</p>
                    
                    <div class="form-group">
                        <label>Your Name</label>
                        <input type="text" id="p-name" placeholder="Enter Name">
                    </div>
                    <div class="form-group">
                        <label>Phone Number</label>
                        <input type="text" id="p-phone" placeholder="+91..." oninput="this.value = this.value.replace(/[^0-9+]/g, '')">
                    </div>
                    <div class="form-group">
                        <label>Hostel</label>
                        <select id="p-hostel">
                            <option value="" disabled selected>Select Hostel</option>
                            <option value="Sarojini Bhawan – A">Sarojini Bhawan – A</option>
                            <option value="Sarojini Bhawan – B">Sarojini Bhawan – B</option>
                            <option value="Sarojini Bhawan – C">Sarojini Bhawan – C</option>
                            <option value="Teresa Bhawan – A">Teresa Bhawan – A</option>
                            <option value="Teresa Bhawan – B">Teresa Bhawan – B</option>
                            <option value="Teresa Bhawan – C">Teresa Bhawan – C</option>
                            <option value="Teresa Bhawan - D">Teresa Bhawan - D</option>
                            <option value="Indira Bhawan – A">Indira Bhawan – A</option>
                            <option value="Indira Bhawan – B">Indira Bhawan – B</option>
                            <option value="Indira Bhawan – C">Indira Bhawan – C</option>
                            <option value="Janki Bhawan – A">Janki Bhawan – A</option>
                            <option value="Kalpana Bhawan - A">Kalpana Bhawan - A</option>
                            <option value="Kalpana Bhawan - B">Kalpana Bhawan - B</option>
                            <option value="Shastri Bhawan – A">Shastri Bhawan – A</option>
                            <option value="Shastri Bhawan – B">Shastri Bhawan – B</option>
                            <option value="Shastri Bhawan – C">Shastri Bhawan – C</option>
                            <option value="Kalam Bhawan – A">Kalam Bhawan – A</option>
                            <option value="Kalam Bhawan – B">Kalam Bhawan – B</option>
                            <option value="Kalam Bhawan – C">Kalam Bhawan – C</option>
                            <option value="Tagore Bhawan – A">Tagore Bhawan – A</option>
                            <option value="Tagore Bhawan – B">Tagore Bhawan – B</option>
                            <option value="Tagore Bhawan – C">Tagore Bhawan – C</option>
                            <option value="Milkha Bhawan – A">Milkha Bhawan – A</option>
                            <option value="Dhyaan Bhawan">Dhyaan Bhawan</option>
                            <option value="Sardar Bhawan – A">Sardar Bhawan – A</option>
                            <option value="Sardar Bhawan – B">Sardar Bhawan – B</option>
                            <option value="Atal Bhawan - A 1">Atal Bhawan - A 1</option>
                            <option value="Atal Bhawan - A 2">Atal Bhawan - A 2</option>
                            <option value="Atal Bhawan - B">Atal Bhawan - B</option>
                            <option value="Tilak Bhawan – A">Tilak Bhawan – A</option>
                            <option value="Marie Curle">Marie Curle</option>
                            <option value="Rani Laxmibai A">Rani Laxmibai A</option>
                            <option value="Rani Laxmibai Bhavan - B">Rani Laxmibai Bhavan - B</option>
                            <option value="Albert Einstein">Albert Einstein</option>
                            <option value="Azad Bhavan - A">Azad Bhavan - A</option>
                            <option value="Abraham Lincoln">Abraham Lincoln</option>
                            <option value="Saarthi Hostel">Saarthi Hostel</option>
                            <option value="Shakuntala A">Shakuntala A</option>
                            <option value="Shakuntala B">Shakuntala B</option>
                        </select>
                    </div>
                    <button class="place-order-btn" onclick="saveProfileData()">SAVE DETAILS</button>
                </div>
            </div>

            <div id="profile-orders-view" style="display: none;">
                <div class="profile-header">
                    <button class="back-icon-btn" onclick="showMainView()"><i class="fas fa-arrow-left"></i></button>
                    <h2>My Orders</h2>
                    <div style="width: 32px;"></div>
                </div>
                <div id="orders-list-container" class="orders-list-container">
                    </div>
            </div>

        </div>
    </div>

    <div id="payment-loader" class="payment-loader">
        <div class="loader-content">
            <div class="pulse-container">
                <div class="logo-text">STRINK...</div>
                <div class="pulse-ring"></div>
                <div class="pulse-ring delay"></div>
            </div>
            <h3 id="loader-text">Securing Connection...</h3>
            <p>Please wait while we redirect you</p>
        </div>
    </div>

    <div id="checkout-modal" class="checkout-modal">
        <div class="checkout-container">
            <div class="checkout-header">
                <h2>Checkout</h2>
                <button class="close-modal" onclick="closeCheckoutModal()">&times;</button>
            </div>
            
            <div id="checkout-step-1">
                <div id="clear-data-section" class="clear-data-container" style="display: none;">
                    <span id="welcome-user-msg" style="color:#e6f014; font-size:13px; font-weight:bold; margin-right:10px;"></span>
                    <button type="button" class="clear-data-btn" onclick="clearSavedData()">Not you? Clear Data</button>
                </div>

                <form onsubmit="goToPayment(event)">
                    <div class="form-group">
                        <label>Full Name</label>
                        <input type="text" id="c-name" placeholder="Student Name" required>
                    </div>
                    <div class="form-group">
                        <label>Phone Number (International allowed)</label>
                        <input type="text" id="c-phone" placeholder="+91 9876543210" oninput="this.value = this.value.replace(/[^0-9+]/g, '')" required>
                    </div>
                    
                    <div class="form-group">
                        <label>Select Hostel</label>
                        <select id="c-hostel" required>
                            <option value="" disabled selected>Choose your hostel...</option>
                            <option value="Sarojini Bhawan – A">Sarojini Bhawan – A</option>
                            <option value="Sarojini Bhawan – B">Sarojini Bhawan – B</option>
                            <option value="Sarojini Bhawan – C">Sarojini Bhawan – C</option>
                            <option value="Teresa Bhawan – A">Teresa Bhawan – A</option>
                            <option value="Teresa Bhawan – B">Teresa Bhawan – B</option>
                            <option value="Teresa Bhawan – C">Teresa Bhawan – C</option>
                            <option value="Teresa Bhawan - D">Teresa Bhawan - D</option>
                            <option value="Indira Bhawan – A">Indira Bhawan – A</option>
                            <option value="Indira Bhawan – B">Indira Bhawan – B</option>
                            <option value="Indira Bhawan – C">Indira Bhawan – C</option>
                            <option value="Janki Bhawan – A">Janki Bhawan – A</option>
                            <option value="Kalpana Bhawan - A">Kalpana Bhawan - A</option>
                            <option value="Kalpana Bhawan - B">Kalpana Bhawan - B</option>
                            <option value="Shastri Bhawan – A">Shastri Bhawan – A</option>
                            <option value="Shastri Bhawan – B">Shastri Bhawan – B</option>
                            <option value="Shastri Bhawan – C">Shastri Bhawan – C</option>
                            <option value="Kalam Bhawan – A">Kalam Bhawan – A</option>
                            <option value="Kalam Bhawan – B">Kalam Bhawan – B</option>
                            <option value="Kalam Bhawan – C">Kalam Bhawan – C</option>
                            <option value="Tagore Bhawan – A">Tagore Bhawan – A</option>
                            <option value="Tagore Bhawan – B">Tagore Bhawan – B</option>
                            <option value="Tagore Bhawan – C">Tagore Bhawan – C</option>
                            <option value="Milkha Bhawan – A">Milkha Bhawan – A</option>
                            <option value="Dhyaan Bhawan">Dhyaan Bhawan</option>
                            <option value="Sardar Bhawan – A">Sardar Bhawan – A</option>
                            <option value="Sardar Bhawan – B">Sardar Bhawan – B</option>
                            <option value="Atal Bhawan - A 1">Atal Bhawan - A 1</option>
                            <option value="Atal Bhawan - A 2">Atal Bhawan - A 2</option>
                            <option value="Atal Bhawan - B">Atal Bhawan - B</option>
                            <option value="Tilak Bhawan – A">Tilak Bhawan – A</option>
                            <option value="Marie Curle">Marie Curle</option>
                            <option value="Rani Laxmibai A">Rani Laxmibai A</option>
                            <option value="Rani Laxmibai Bhavan - B">Rani Laxmibai Bhavan - B</option>
                            <option value="Albert Einstein">Albert Einstein</option>
                            <option value="Azad Bhavan - A">Azad Bhavan - A</option>
                            <option value="Abraham Lincoln">Abraham Lincoln</option>
                            <option value="Saarthi Hostel">Saarthi Hostel</option>
                            <option value="Shakuntala A">Shakuntala A</option>
                            <option value="Shakuntala B">Shakuntala B</option>
                        </select>
                    </div>

                    <div class="bill-summary">
                        <div class="bill-row"><span>Item Subtotal</span><span id="bill-subtotal">₹0</span></div>
                        <div class="bill-row"><span>Delivery Charge</span><span>₹40</span></div>
                        <div class="bill-row"><span>Platform Fee</span><span>₹5</span></div>
                        <div class="bill-row total"><span>TOTAL TO PAY</span><span id="bill-total">₹0</span></div>
                    </div>

                    <div class="delivery-note"><i class="fas fa-info-circle"></i><p>I know the delivery charge is a little high. We take this charge to run the platform and maintain our system. For every 100 orders on our platform, we reduce the delivery charge by ₹5!</p></div>

                    <button type="submit" class="place-order-btn">PROCEED TO PAYMENT</button>
                </form>
            </div>

            <div id="checkout-step-2" style="display: none;">
                <h3 style="text-align: center; margin-bottom: 20px; color: #ccc;">Select Payment Method</h3>
                <div class="payment-options">
                    <div class="payment-card" onclick="showQRSection()"><div class="pay-icon"><i class="fas fa-qrcode"></i></div><h4>Pay via QR Code</h4><p>Scan & Pay instantly</p></div>
                    <div class="payment-card" onclick="startAppPayment()"><div class="pay-icon"><i class="fas fa-mobile-alt"></i></div><h4>Pay with App</h4><p>UPI, GPay, PhonePe</p></div>
                </div>
                <div class="payment-total-preview">Total Payable: <span id="payment-step-total" style="color: #e6f014;">₹0</span></div>
                <button class="back-btn" onclick="backToAddress()">Back to Details</button>
            </div>

            <div id="checkout-step-3" style="display: none; text-align: center;">
                <h3 style="margin-bottom: 10px;">Scan & Pay</h3>
                <div class="timer-box" id="timer">03:00</div>
                <div class="qr-container"><img id="dynamic-qr" src="" alt="Payment QR Code"></div>
                <p style="color: #ccc; margin-bottom: 15px; font-size: 14px;">Total Amount: <span id="qr-amount" style="color: #e6f014; font-weight: bold;">₹0</span></p>
                <div class="form-group transaction-group">
                    <label style="text-align: left;">Enter UPI Transaction ID</label>
                    <div style="position: relative;">
                        <input type="text" id="txn-id-qr" placeholder="e.g. 40281934..." required>
                        <div class="tooltip-container"><i class="fas fa-info-circle info-icon"></i><div class="tooltip-text">GPay: "UPI Transaction ID"<br>PhonePe: "Transaction ID"<br>Paytm: "UPI Ref No"</div></div>
                    </div>
                </div>
                <button class="place-order-btn" onclick="verifyAndSubmitOrder('qr')">VERIFY & SUBMIT</button>
                <button class="back-btn" onclick="backToPaymentSelect()">Back to Options</button>
            </div>

            <div id="checkout-step-4-app" style="display: none; text-align: center;">
                <div class="timer-box" id="app-timer">03:00</div>
                <div style="margin-bottom: 20px; animation: fadeIn 1s;">
                    <i class="fas fa-check-circle" style="font-size: 50px; color: #e6f014; margin-bottom: 15px;"></i>
                    <h3 style="color: #fff;">Payment Initiated</h3>
                    <p style="color: #888; font-size: 13px;">Please complete the payment in your app and enter the Transaction ID below.</p>
                </div>
                <div class="form-group transaction-group">
                    <label style="text-align: left;">Enter UPI Transaction ID</label>
                    <div style="position: relative;">
                        <input type="text" id="txn-id-app" placeholder="e.g. 40281934..." required>
                        <div class="tooltip-container"><i class="fas fa-info-circle info-icon"></i><div class="tooltip-text">GPay: "UPI Transaction ID"<br>PhonePe: "Transaction ID"<br>Paytm: "UPI Ref No"</div></div>
                    </div>
                </div>
                <button class="place-order-btn" onclick="verifyAndSubmitOrder('app')">VERIFY & SUBMIT</button>
                <button class="back-btn" onclick="cancelAppPayment()">Cancel Order</button>
            </div>
        </div>
    </div>

    <div id="order-success-screen" class="order-success-screen">
        <div class="success-card">
            <div class="success-icon">
                <svg viewBox="0 0 52 52" class="checkmark">
                    <circle cx="26" cy="26" r="25" fill="none" class="checkmark-circle"/>
                    <path fill="none" d="M14.1 27.2l7.1 7.2 16.7-16.8" class="checkmark-check"/>
                </svg>
            </div>
            <h2>Order Placed!</h2>
            <p id="success-quote" class="success-quote"></p>
            <div class="order-id-box">Order ID: <span id="final-order-id">#000000</span></div>
            <p class="delivery-msg"><i class="fas fa-shipping-fast"></i> Your order will be delivered within 2-3 hours.</p>

            <div class="on-screen-bill">
                <h4>Bill Summary</h4>
                <div id="success-bill-items"></div>
                <div class="bill-total-row">
                    <span>Total Paid</span>
                    <span id="success-bill-total"></span>
                </div>
            </div>
            
            <button class="download-btn" onclick="downloadInvoice()">
                <i class="fas fa-file-download"></i> Download Invoice
            </button>
            <button class="continue-btn" onclick="closeSuccessScreen()">Continue Shopping</button>
        </div>
    </div>

    <div id="printable-invoice" class="printable-invoice">
        <div class="invoice-header">
            <h1>STRINK...</h1>
            <p>INVOICE</p>
        </div>
        <div class="invoice-details">
            <div>
                <strong>Billed To:</strong><br>
                <span id="inv-name"></span><br>
                <span id="inv-phone"></span><br>
                <span id="inv-hostel"></span>
            </div>
            <div style="text-align: right;">
                <strong>Order Details:</strong><br>
                ID: <span id="inv-order-id"></span><br>
                Date: <span id="inv-date"></span>
            </div>
        </div>
        <table class="invoice-table">
            <thead><tr><th>Item</th><th>Price</th></tr></thead>
            <tbody id="inv-items"></tbody>
        </table>
        <div class="invoice-footer">
            <div class="inv-row"><span>Subtotal:</span> <span id="inv-subtotal"></span></div>
            <div class="inv-row"><span>Delivery:</span> <span>₹40</span></div>
            <div class="inv-row"><span>Platform Fee:</span> <span>₹5</span></div>
            <div class="inv-row total"><span>Grand Total:</span> <span id="inv-total"></span></div>
        </div>
        <div class="invoice-note">Thank you for shopping with STRINK ❤️</div>
    </div>

    <div id="all-categories-modal" class="all-categories-modal">
        <div class="modal-header">
            <h2>All Categories</h2>
            <button class="close-modal" onclick="closeAllCategories()">&times;</button>
        </div>
        <div class="all-cats-grid" id="all-cats-grid"></div>
    </div>

    <section class="hero-slider">
        <div class="slides-container">
            <div class="slide active">
                <img src="https://images.unsplash.com/photo-1523381210434-271e8be1f52b?ixlib=rb-4.0.3&auto=format&fit=crop&w=1170&q=80">
                <div class="hero-content">
                    <p class="hero-subtitle">LIMITED EDITION</p>
                    <h1 class="hero-title">THE DROP</h1>
                    <p class="hero-description">CURATED MALL CULTURE.</p>
                </div>
            </div>
            <div class="slide">
                <img src="https://images.unsplash.com/photo-1483985988355-763728e1935b?ixlib=rb-4.0.3&auto=format&fit=crop&w=1170&q=80">
                <div class="hero-content">
                    <p class="hero-subtitle">NEW ARRIVALS</p>
                    <h1 class="hero-title">STREET STYLE</h1>
                    <p class="hero-description">URBAN ESSENTIALS.</p>
                </div>
            </div>
            <div class="slide">
                <img src="https://images.unsplash.com/photo-1555529669-e69e7aa0ba9a?ixlib=rb-4.0.3&auto=format&fit=crop&w=1170&q=80">
                <div class="hero-content">
                    <p class="hero-subtitle">FLASH SALE</p>
                    <h1 class="hero-title">GET 50% OFF</h1>
                    <p class="hero-description">ON SELECTED ITEMS.</p>
                </div>
            </div>
        </div>
        <div class="slider-dots">
            <span class="dot active" onclick="currentSlide(0)"></span>
            <span class="dot" onclick="currentSlide(1)"></span>
            <span class="dot" onclick="currentSlide(2)"></span>
        </div>
    </section>

    <section class="circle-menu-section">
        <button class="scroll-arrow left" onclick="scrollCircles(-200)"><i class="fas fa-chevron-left"></i></button>
        <div class="circle-container" id="circle-container">
            <div class="circle-item" onclick="filterByCircle('new')"><div class="circle-img-box"><img src="https://images.unsplash.com/photo-1485230946086-1d99d543b599?auto=format&fit=crop&w=200&q=80"></div><p>New In</p></div>
            <div class="circle-item" onclick="filterByCircle('mancare')"><div class="circle-img-box"><img src="https://images.unsplash.com/photo-1556228720-1987bad28426?auto=format&fit=crop&w=200&q=80"></div><p>Man Care</p></div>
            <div class="circle-item" onclick="filterByCircle('men')"><div class="circle-img-box"><img src="https://images.unsplash.com/photo-1488161628813-994252600322?auto=format&fit=crop&w=200&q=80"></div><p>Men</p></div>
            <div class="circle-item" onclick="filterByCircle('women')"><div class="circle-img-box"><img src="https://images.unsplash.com/photo-1525845859779-54d477ff291f?auto=format&fit=crop&w=200&q=80"></div><p>Women</p></div>
            <div class="circle-item" onclick="filterByCircle('shoes')"><div class="circle-img-box"><img src="https://images.unsplash.com/photo-1549298916-b41d501d3772?auto=format&fit=crop&w=200&q=80"></div><p>Shoes</p></div>
            <div class="circle-item" onclick="filterByCircle('watches')"><div class="circle-img-box"><img src="https://images.unsplash.com/photo-1524592094714-0f0654e20314?auto=format&fit=crop&w=200&q=80"></div><p>Watches</p></div>
            <div class="circle-item" onclick="openAllCategories()"><div class="circle-img-box view-all-circle"><i class="fas fa-th-large"></i></div><p>View All</p></div>
        </div>
        <button class="scroll-arrow right" onclick="scrollCircles(200)"><i class="fas fa-chevron-right"></i></button>
    </section>

    <div class="categories">
        <button class="cat-btn active" data-filter="all">🔥 ALL VIBES</button>
        <button class="cat-btn" data-filter="sale">💸 SALE</button>
        <button class="cat-btn" data-filter="men">👨 MEN</button>
        <button class="cat-btn" data-filter="women">👩 WOMEN</button>
        <button class="cat-btn" data-filter="kids">🧸 KIDS</button>
        <button class="cat-btn" data-filter="shoes">👟 SHOES</button>
        <button class="cat-btn" data-filter="bags">👜 BAGS</button>
        <button class="cat-btn" data-filter="watches">⌚ WATCHES</button>
        <button class="cat-btn" data-filter="tech">🎧 TECH</button>
        <button class="cat-btn" data-filter="sports">⚽ SPORTS</button>
        <button class="cat-btn" data-filter="beauty">💄 BEAUTY</button>
        <button class="cat-btn" data-filter="winter">❄️ WINTER</button>
    </div>

    <section class="product-grid" id="product-grid">
        <div class="product-card" data-category="men new winter sale" data-description="winter warm casual streetwear black">
            <div class="product-image-container"><span class="discount-tag">-50%</span><img src="https://images.unsplash.com/photo-1556821840-3a63f95609a7?ixlib=rb-4.0.3&auto=format&fit=crop&w=687&q=80" class="product-img"></div>
            <div class="product-info"><h3 class="product-title">Oversized Graffiti Hoodie</h3><div class="product-footer"><div class="price-container"><span class="current-price">₹2,499</span><span class="original-price">₹4,999</span></div><button class="add-to-cart-btn">+</button></div></div>
        </div>
        <div class="product-card" data-category="men tech women  accessories" data-description="sunglasses summer sun glass cool">
            <div class="product-image-container"><span class="discount-tag">-52%</span><img src="https://images.unsplash.com/photo-1577803645773-f96470509666?ixlib=rb-4.0.3&auto=format&fit=crop&w=687&q=80" class="product-img"></div>
            <div class="product-info"><h3 class="product-title">Cyber-Punk Shades</h3><div class="product-footer"><div class="price-container"><span class="current-price">₹1,200</span><span class="original-price">₹2,500</span></div><button class="add-to-cart-btn">+</button></div></div>
        </div>
        <div class="product-card" data-category="women party sale" data-description="red elegant night gown date">
            <div class="product-image-container"><span class="discount-tag">-42%</span><img src="https://images.unsplash.com/photo-1596908181039-9f1123760529?ixlib=rb-4.0.3&auto=format&fit=crop&w=687&q=80" class="product-img"></div>
            <div class="product-info"><h3 class="product-title">Satin Slip Dress</h3><div class="product-footer"><div class="price-container"><span class="current-price">₹3,200</span><span class="original-price">₹5,500</span></div><button class="add-to-cart-btn">+</button></div></div>
        </div>
        <div class="product-card" data-category="men watches luxury" data-description="women time clock gold analog business">
            <div class="product-image-container"><span class="discount-tag">-15%</span><img src="https://images.unsplash.com/photo-1524592094714-0f0654e20314?ixlib=rb-4.0.3&auto=format&fit=crop&w=1099&q=80" class="product-img"></div>
            <div class="product-info"><h3 class="product-title">Analog Classic Watch</h3><div class="product-footer"><div class="price-container"><span class="current-price">₹8,500</span><span class="original-price">₹10,000</span></div><button class="add-to-cart-btn">+</button></div></div>
        </div>
        <div class="product-card" data-category="men shoes new" data-description="running women sport gym red footwear">
            <div class="product-image-container"><span class="discount-tag">NEW</span><img src="https://images.unsplash.com/photo-1542291026-7eec264c27ff?ixlib=rb-4.0.3&auto=format&fit=crop&w=1170&q=80" class="product-img"></div>
            <div class="product-info"><h3 class="product-title">Red High-Top Sneakers</h3><div class="product-footer"><div class="price-container"><span class="current-price">₹5,400</span><span class="original-price"></span></div><button class="add-to-cart-btn">+</button></div></div>
        </div>
        <div class="product-card" data-category="men mancare beauty" data-description="wash clean foam hair care grooming charcoal black">
            <div class="product-image-container"><span class="discount-tag">NEW</span><img src="https://images.unsplash.com/photo-1585232351009-315969192b12?q=80&w=2070&auto=format&fit=crop" class="product-img"></div>
            <div class="product-info"><h3 class="product-title">Charcoal Detox Shampoo</h3><div class="product-footer"><div class="price-container"><span class="current-price">₹450</span><span class="original-price">₹600</span></div><button class="add-to-cart-btn">+</button></div></div>
        </div>
    </section>

    <div id="toast" class="toast">Added to Bag!</div>

    <script>
        /* --- CSS FIX: REMOVE WHITE SLIDER LINE FROM CART --- */
        const style = document.createElement('style');
        style.textContent = `
            .cart-items::-webkit-scrollbar { display: none !important; }
            .cart-items { -ms-overflow-style: none !important; scrollbar-width: none !important; }
            .whatsapp-glow-btn {
                display: flex; align-items: center; justify-content: center; gap: 10px;
                width: 100%; padding: 15px; margin-bottom: 15px;
                background-color: #25D366; color: white; text-decoration: none;
                font-weight: 900; font-size: 14px; border-radius: 12px;
                box-shadow: 0 0 10px rgba(37, 211, 102, 0.5);
                animation: wa-glow 2s infinite ease-in-out;
            }
            @keyframes wa-glow {
                0% { box-shadow: 0 0 5px rgba(37, 211, 102, 0.4); }
                50% { box-shadow: 0 0 20px rgba(37, 211, 102, 0.8); }
                100% { box-shadow: 0 0 5px rgba(37, 211, 102, 0.4); }
            }
        `;
        document.head.appendChild(style);

        /* --- SLIDER LOGIC --- */
        let slideIndex = 0;
        showSlides();
        function showSlides() {
            let slides = document.getElementsByClassName("slide");
            let dots = document.getElementsByClassName("dot");
            if(!slides.length) return;
            for (let i = 0; i < slides.length; i++) { slides[i].style.display = "none"; slides[i].classList.remove("active"); }
            slideIndex++;
            if (slideIndex > slides.length) {slideIndex = 1}    
            slides[slideIndex-1].style.display = "block"; slides[slideIndex-1].classList.add("active");
            if(dots.length > 0) { for(let i=0; i<dots.length; i++) dots[i].classList.remove("active"); dots[slideIndex-1].classList.add("active"); }
            setTimeout(showSlides, 3000); 
        }
        function currentSlide(n) { slideIndex = n; }

        /* --- CIRCLE SCROLL --- */
        function scrollCircles(amount) {
            document.getElementById('circle-container').scrollBy({ left: amount, behavior: 'smooth' });
        }

        /* --- CLICK CIRCLE TO FILTER --- */
        function filterByCircle(categoryName) {
            const searchInput = document.getElementById('search-input');
            const heroSlider = document.querySelector('.hero-slider');
            const circleMenu = document.querySelector('.circle-menu-section');
            const categoryButtons = document.querySelector('.categories');
            
            searchInput.value = '';
            heroSlider.classList.remove('hide-on-search');
            circleMenu.classList.remove('hide-on-search');
            categoryButtons.classList.remove('hide-on-search');

            const cleanName = categoryName.toLowerCase().replace(/\s+/g, '');
            const directBtn = document.querySelector(`.cat-btn[data-filter="${cleanName}"]`);
            
            if (directBtn) {
                directBtn.click();
            } else {
                const cards = document.querySelectorAll('.product-card');
                document.querySelectorAll('.cat-btn').forEach(b => b.classList.remove('active'));
                cards.forEach(card => {
                    const productCats = card.getAttribute('data-category').toLowerCase().split(' ');
                    if (productCats.includes(cleanName)) card.classList.remove('hidden');
                    else card.classList.add('hidden');
                });
                const grid = document.getElementById('product-grid');
                const offset = grid.getBoundingClientRect().top + window.pageYOffset - 120;
                window.scrollTo({top: offset, behavior: 'smooth'});
            }
        }

        /* --- SEARCH LOGIC --- */
        const searchInput = document.getElementById('search-input');
        const heroSlider = document.querySelector('.hero-slider');
        const circleMenu = document.querySelector('.circle-menu-section');
        const categoryButtons = document.querySelector('.categories');

        if(searchInput) {
            searchInput.addEventListener('input', (e) => {
                const searchText = e.target.value.toLowerCase().trim();
                const cards = document.querySelectorAll('.product-card');

                if (searchText.length > 0) {
                    heroSlider.classList.add('hide-on-search');
                    circleMenu.classList.add('hide-on-search');
                    categoryButtons.classList.add('hide-on-search');

                    cards.forEach(card => {
                        const title = card.querySelector('.product-title').innerText.toLowerCase();
                        const desc = card.hasAttribute('data-description') ? card.getAttribute('data-description').toLowerCase() : '';
                        if (title.includes(searchText) || desc.includes(searchText)) card.classList.remove('hidden');
                        else card.classList.add('hidden');
                    });
                } else {
                    heroSlider.classList.remove('hide-on-search');
                    circleMenu.classList.remove('hide-on-search');
                    categoryButtons.classList.remove('hide-on-search');
                    const activeBtn = document.querySelector('.cat-btn.active');
                    if(activeBtn) activeBtn.click(); 
                    else cards.forEach(card => card.classList.remove('hidden'));
                }
            });
        }

        /* --- ALL CATEGORIES MODAL --- */
        const allCategories = [
            { name: "New In", img: "https://images.unsplash.com/photo-1485230946086-1d99d543b599?auto=format&fit=crop&w=200&q=80" },
            { name: "Sale", img: "https://images.unsplash.com/photo-1607083206869-4c7672e72a8a?auto=format&fit=crop&w=200&q=80" },
            { name: "Men", img: "https://images.unsplash.com/photo-1488161628813-994252600322?auto=format&fit=crop&w=200&q=80" },
            { name: "Women", img: "https://images.unsplash.com/photo-1525845859779-54d477ff291f?auto=format&fit=crop&w=200&q=80" },
            { name: "Shoes", img: "https://images.unsplash.com/photo-1549298916-b41d501d3772?auto=format&fit=crop&w=200&q=80" },
            { name: "Watches", img: "https://images.unsplash.com/photo-1524592094714-0f0654e20314?auto=format&fit=crop&w=200&q=80" },
            { name: "Beauty", img: "https://images.unsplash.com/photo-1522337660859-02fbefca4702?auto=format&fit=crop&w=200&q=80" },
            { name: "Tech", img: "https://images.unsplash.com/photo-1550009158-9ebf69173e03?auto=format&fit=crop&w=200&q=80" },
            { name: "Sports", img: "https://images.unsplash.com/photo-1517649763962-0c623066013b?auto=format&fit=crop&w=200&q=80" },
            { name: "Bags", img: "https://images.unsplash.com/photo-1590874103328-eac38a683ce7?auto=format&fit=crop&w=200&q=80" },
            { name: "Home", img: "https://images.unsplash.com/photo-1513694203232-719a280e022f?auto=format&fit=crop&w=200&q=80" },
            { name: "Kids", img: "https://images.unsplash.com/photo-1514090458221-65bb69cf63e6?auto=format&fit=crop&w=200&q=80" },
            { name: "Luxury", img: "https://images.unsplash.com/photo-1548036328-c9fa89d128fa?auto=format&fit=crop&w=200&q=80" },
            { name: "Gifts", img: "https://images.unsplash.com/photo-1513885535751-8b9238bd345a?auto=format&fit=crop&w=200&q=80" },
            { name: "Winter", img: "https://images.unsplash.com/photo-1516762689617-e1cffcef479d?auto=format&fit=crop&w=200&q=80" },
            { name: "Summer", img: "https://images.unsplash.com/photo-1507525428034-b723cf961d3e?auto=format&fit=crop&w=200&q=80" },
            { name: "Denim", img: "https://images.unsplash.com/photo-1541099649105-f69ad21f3246?auto=format&fit=crop&w=200&q=80" },
            { name: "Formal", img: "https://images.unsplash.com/photo-1595950653106-6c9ebd614d3a?auto=format&fit=crop&w=200&q=80" },
            { name: "Swim", img: "https://images.unsplash.com/photo-1565259160565-d6ee17992790?auto=format&fit=crop&w=200&q=80" },
            { name: "Lingerie", img: "https://images.unsplash.com/photo-1597858604473-199623e1f726?auto=format&fit=crop&w=200&q=80" },
            { name: "Sleep", img: "https://images.unsplash.com/photo-1621503375836-e88536d5a864?auto=format&fit=crop&w=200&q=80" },
            { name: "Party", img: "https://images.unsplash.com/photo-1514525253440-b393452e8d26?auto=format&fit=crop&w=200&q=80" },
            { name: "Office", img: "https://images.unsplash.com/photo-1487222477894-8943e31ef7b2?auto=format&fit=crop&w=200&q=80" },
            { name: "Travel", img: "https://images.unsplash.com/photo-1469854523086-cc02fe5d8800?auto=format&fit=crop&w=200&q=80" },
            { name: "Vintage", img: "https://images.unsplash.com/photo-1550920455-8321ca76b91d?auto=format&fit=crop&w=200&q=80" },
            { name: "Pets", img: "https://images.unsplash.com/photo-1583337130417-3346a1be7dee?auto=format&fit=crop&w=200&q=80" },
            { name: "Art", img: "https://images.unsplash.com/photo-1513364776144-60967b0f800f?auto=format&fit=crop&w=200&q=80" },
            { name: "Music", img: "https://images.unsplash.com/photo-1511671782779-c97d3d27a1d4?auto=format&fit=crop&w=200&q=80" },
            { name: "Gaming", img: "https://images.unsplash.com/photo-1552820728-8b83bb6b773f?auto=format&fit=crop&w=200&q=80" },
            { name: "Books", img: "https://images.unsplash.com/photo-1512820790803-83ca734da794?auto=format&fit=crop&w=200&q=80" },
            { name: "Man Care", img: "https://images.unsplash.com/photo-1556228720-1987bad28426?auto=format&fit=crop&w=200&q=80" }
        ];

        function openAllCategories() {
            const modal = document.getElementById('all-categories-modal');
            const grid = document.getElementById('all-cats-grid');
            if(!modal || !grid) return;
            grid.innerHTML = '';
            allCategories.forEach(cat => {
                const item = document.createElement('div');
                item.classList.add('circle-item');
                item.innerHTML = `<div class="circle-img-box"><img src="${cat.img}" alt="${cat.name}"></div><p>${cat.name}</p>`;
                item.addEventListener('click', () => { 
                    closeAllCategories(); 
                    filterByCircle(cat.name); 
                });
                grid.appendChild(item);
            });
            modal.classList.add('open');
        }
        function closeAllCategories() { document.getElementById('all-categories-modal').classList.remove('open'); }

        /* --- BUTTON FILTER --- */
        const filterBtns = document.querySelectorAll('.cat-btn');
        filterBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                searchInput.value = '';
                heroSlider.classList.remove('hide-on-search');
                circleMenu.classList.remove('hide-on-search');
                categoryButtons.classList.remove('hide-on-search');

                filterBtns.forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                const filterValue = btn.getAttribute('data-filter');
                const cards = document.querySelectorAll('.product-card');
                
                cards.forEach(card => {
                    const productCats = card.getAttribute('data-category').toLowerCase().split(' ');
                    if (filterValue === 'all' || productCats.includes(filterValue)) {
                        card.classList.remove('hidden');
                    } else {
                        card.classList.add('hidden');
                    }
                });
            });
        });

        /* --- CART & CHECKOUT LOGIC --- */
        let cart = JSON.parse(localStorage.getItem('omni_cart')) || [];

        const cartCountEl = document.getElementById('cart-count');
        const cartSidebar = document.getElementById('cart-sidebar');
        const cartOverlay = document.getElementById('cart-overlay');
        const cartItemsContainer = document.getElementById('cart-items');
        const cartTotalEl = document.getElementById('cart-total'); 
        const billSubtotalEl = document.getElementById('bill-subtotal');
        const billTotalEl = document.getElementById('bill-total');
        const checkoutModal = document.getElementById('checkout-modal');
        const toast = document.getElementById('toast');

        const PLATFORM_FEE = 5;

        /* --- DYNAMIC DELIVERY CHARGE LOGIC (FIXED) --- */
        function getDynamicDeliveryCharge() {
            const history = JSON.parse(localStorage.getItem('omni_order_history')) || [];
            const currentOrderNum = history.length + 1;

            if (currentOrderNum === 1) return 19;
            if (currentOrderNum === 2) return 19;
            if (currentOrderNum === 3) return 24;
            if (currentOrderNum === 4) return 24;
            if (currentOrderNum === 5) return 29;
            if (currentOrderNum === 6) return 24;
            if (currentOrderNum === 7) return 29;
            if (currentOrderNum === 8) return 34;
            if (currentOrderNum === 9) return 29;
            if (currentOrderNum === 10) return 19;
            
            return 34; // 11th order and beyond
        }

        updateCartUI();

        // PERSISTENT CHECK: Check for pending payment state on reload
        document.addEventListener('DOMContentLoaded', () => {
            const paymentStatus = localStorage.getItem('omni_payment_pending');
            if (paymentStatus === 'true') {
                const method = localStorage.getItem('omni_payment_method');
                // Restore based on which method was used
                openCheckoutModal(true); 
                
                // Hide Step 1 & 2
                document.getElementById('checkout-step-1').style.display = 'none';
                document.getElementById('checkout-step-2').style.display = 'none';

                if (method === 'qr') {
                    document.getElementById('checkout-step-3').style.display = 'block';
                    document.getElementById('checkout-step-4-app').style.display = 'none';
                    
                    // Re-render QR details
                    let subtotal = 0;
                    cart.forEach(item => subtotal += item.price);
                    const dynamicDelivery = getDynamicDeliveryCharge();
                    const finalTotal = subtotal + dynamicDelivery + PLATFORM_FEE;
                    document.getElementById('qr-amount').innerText = '₹' + finalTotal.toLocaleString();
                    
                    const upiID = "manjeetkeshrihkp@oksbi";
                    const upiLink = `upi://pay?pa=${upiID}&pn=OMNI&am=${finalTotal}&cu=INR`;
                    const qrUrl = `https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(upiLink)}`;
                    document.getElementById('dynamic-qr').src = qrUrl;

                    // Resume Timer with Robust Logic
                    const expiry = localStorage.getItem('omni_payment_expiry');
                    if (expiry) {
                        let remaining = Math.floor((parseInt(expiry) - Date.now()) / 1000);
                        if (remaining > 0) {
                            startTimer(remaining, 'timer');
                        } else {
                            handleExpiredSession();
                        }
                    }

                } else if (method === 'app') {
                    document.getElementById('checkout-step-4-app').style.display = 'block';
                    
                    // Resume Timer
                    const expiry = localStorage.getItem('omni_payment_expiry');
                    if (expiry) {
                        let remaining = Math.floor((parseInt(expiry) - Date.now()) / 1000);
                        if (remaining > 0) {
                            startTimer(remaining, 'app-timer');
                        } else {
                            handleExpiredSession();
                        }
                    }
                }
            }
            
            // Step-by-Step Data Capture
            ['c-name', 'c-phone', 'c-hostel'].forEach(id => {
                const el = document.getElementById(id);
                if(el) el.addEventListener('change', () => {
                    const user = { name: document.getElementById('c-name').value, phone: document.getElementById('c-phone').value, hostel: document.getElementById('c-hostel').value };
                    localStorage.setItem('omni_user', JSON.stringify(user));
                });
            });
        });

        const addBtns = document.querySelectorAll('.add-to-cart-btn');
        addBtns.forEach(btn => {
            btn.addEventListener('click', (e) => {
                const card = e.target.closest('.product-card');
                const title = card.querySelector('.product-title').innerText;
                const priceStr = card.querySelector('.current-price').innerText;
                const imgSrc = card.querySelector('.product-img').src;
                const price = parseInt(priceStr.replace(/[^\d]/g, ''));
                cart.push({ title, price, imgSrc });
                localStorage.setItem('omni_cart', JSON.stringify(cart));
                updateCartUI();
                showToast();
            });
        });

        function updateCartUI() {
            if(cartCountEl) {
                cartCountEl.innerText = cart.length;
                cartCountEl.style.display = cart.length > 0 ? 'block' : 'none';
            }
            if(cartItemsContainer) {
                cartItemsContainer.innerHTML = '';
                if (cart.length === 0) {
                    cartItemsContainer.innerHTML = '<p class="empty-cart-msg">Your bag is empty.</p>';
                    if(cartTotalEl) cartTotalEl.innerText = '₹0';
                    return;
                }
                let subtotal = 0;
                cart.forEach((item, index) => {
                    subtotal += item.price;
                    const itemEl = document.createElement('div');
                    itemEl.classList.add('cart-item');
                    itemEl.innerHTML = `<img src="${item.imgSrc}" class="cart-item-img"><div class="cart-item-details"><div class="cart-item-title">${item.title}</div><div class="cart-item-price">₹${item.price.toLocaleString()}</div></div><i class="fas fa-trash remove-btn" onclick="removeItem(${index})"></i>`;
                    cartItemsContainer.appendChild(itemEl);
                });
                if(cartTotalEl) cartTotalEl.innerText = '₹' + subtotal.toLocaleString();
            }
        }

        window.removeItem = function(index) {
            cart.splice(index, 1);
            localStorage.setItem('omni_cart', JSON.stringify(cart));
            updateCartUI();
        }

        function showToast() {
            toast.className = "toast show";
            setTimeout(() => { toast.className = toast.className.replace("show", ""); }, 3000);
        }

        function openCart() { cartSidebar.classList.add('open'); cartOverlay.classList.add('open'); }
        function closeCart() { cartSidebar.classList.remove('open'); cartOverlay.classList.remove('open'); }

        /* --- CHECKOUT FUNCTIONS --- */
        window.openCheckoutModal = function(isReturningPayment = false) {
            if (!isReturningPayment && cart.length === 0) { alert("Your bag is empty!"); return; }
            const savedData = JSON.parse(localStorage.getItem('omni_user'));
            if(savedData) {
                document.getElementById('c-name').value = savedData.name || "";
                document.getElementById('c-phone').value = savedData.phone || "";
                document.getElementById('c-hostel').value = savedData.hostel || "";
                document.getElementById('clear-data-section').style.display = 'flex';
                document.getElementById('welcome-user-msg').innerText = `Welcome back, ${savedData.name}!`;
            }
            
            // CALC TOTALS WITH DYNAMIC DELIVERY
            let subtotal = 0;
            cart.forEach(item => subtotal += item.price);
            const dynamicDelivery = getDynamicDeliveryCharge();
            const finalTotal = subtotal + dynamicDelivery + PLATFORM_FEE;
            
            billSubtotalEl.innerText = '₹' + subtotal.toLocaleString();
            
            // Find delivery row and update
            const billRows = document.querySelectorAll('.bill-summary .bill-row');
            if(billRows.length > 1) {
                billRows[1].querySelector('span:last-child').innerText = '₹' + dynamicDelivery;
            }

            billTotalEl.innerText = '₹' + finalTotal.toLocaleString();
            document.getElementById('payment-step-total').innerText = '₹' + finalTotal.toLocaleString();
            
            closeCart();
            checkoutModal.classList.add('open');
            if(isReturningPayment) {
                document.getElementById('checkout-step-1').style.display = 'none';
                document.getElementById('checkout-step-2').style.display = 'none';
            } else {
                document.getElementById('checkout-step-1').style.display = 'block';
                document.getElementById('checkout-step-2').style.display = 'none';
            }
        }

        window.closeCheckoutModal = function() { checkoutModal.classList.remove('open'); }

        window.clearSavedData = function() {
            localStorage.removeItem('omni_user');
            document.getElementById('c-name').value = '';
            document.getElementById('c-phone').value = '';
            document.getElementById('c-hostel').selectedIndex = 0;
            document.getElementById('clear-data-section').style.display = 'none';
            alert("Saved details cleared!");
        }

        window.goToPayment = function(e) {
            e.preventDefault();
            const user = { name: document.getElementById('c-name').value, phone: document.getElementById('c-phone').value, hostel: document.getElementById('c-hostel').value };
            localStorage.setItem('omni_user', JSON.stringify(user));
            document.getElementById('checkout-step-1').style.display = 'none';
            document.getElementById('checkout-step-2').style.display = 'block';
        }

        window.backToAddress = function() {
            document.getElementById('checkout-step-2').style.display = 'none';
            document.getElementById('checkout-step-1').style.display = 'block';
        }

        window.backToPaymentSelect = function() {
            document.getElementById('checkout-step-3').style.display = 'none';
            document.getElementById('checkout-step-4-app').style.display = 'none';
            document.getElementById('checkout-step-2').style.display = 'block';
            localStorage.removeItem('omni_payment_pending');
            clearInterval(timerInterval);
        }

        /* --- PAYMENT LOGIC --- */
        let timerInterval;

        window.showQRSection = function() {
            document.getElementById('checkout-step-2').style.display = 'none';
            document.getElementById('checkout-step-3').style.display = 'block';
            localStorage.setItem('omni_payment_pending', 'true');
            localStorage.setItem('omni_payment_method', 'qr');
            
            let subtotal = 0;
            cart.forEach(item => subtotal += item.price);
            const dynamicDelivery = getDynamicDeliveryCharge();
            const finalTotal = subtotal + dynamicDelivery + PLATFORM_FEE;
            
            document.getElementById('qr-amount').innerText = '₹' + finalTotal.toLocaleString();
            const upiLink = `upi://pay?pa=manjeetkeshrihkp@oksbi&pn=OMNI&am=${finalTotal}&cu=INR`;
            document.getElementById('dynamic-qr').src = `https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(upiLink)}`;
            
            const expiry = Date.now() + 180000;
            localStorage.setItem('omni_payment_expiry', expiry);
            startTimer(180, 'timer'); 
        }

        window.startAppPayment = function() {
            document.getElementById('payment-loader').style.display = 'flex';
            setTimeout(() => {
                let subtotal = 0;
                cart.forEach(item => subtotal += item.price);
                const dynamicDelivery = getDynamicDeliveryCharge();
                const finalTotal = subtotal + dynamicDelivery + PLATFORM_FEE;
                
                localStorage.setItem('omni_payment_pending', 'true');
                localStorage.setItem('omni_payment_method', 'app');
                const expiry = Date.now() + 180000;
                localStorage.setItem('omni_payment_expiry', expiry);
                
                window.location.href = `upi://pay?pa=manjeetkeshrihkp@oksbi&pn=OMNI&am=${finalTotal}&cu=INR`;
                setTimeout(() => {
                    document.getElementById('payment-loader').style.display = 'none';
                    document.getElementById('checkout-step-2').style.display = 'none';
                    document.getElementById('checkout-step-4-app').style.display = 'block';
                    startTimer(180, 'app-timer');
                }, 1500);
            }, 2000);
        }

        /* --- FIXED TIMER LOGIC --- */
        function startTimer(duration, displayId) {
            let timer = duration;
            const display = document.getElementById(displayId);
            if (!display) return;

            // Immediate update
            updateTimerDisplay(timer, display);

            clearInterval(timerInterval);
            timerInterval = setInterval(() => {
                timer--;
                if (timer < 0) {
                    handleExpiredSession();
                    return;
                }
                updateTimerDisplay(timer, display);
            }, 1000);
        }

        function updateTimerDisplay(time, displayElement) {
            let minutes = parseInt(time / 60, 10);
            let seconds = parseInt(time % 60, 10);
            minutes = minutes < 10 ? "0" + minutes : minutes;
            seconds = seconds < 10 ? "0" + seconds : seconds;
            displayElement.textContent = minutes + ":" + seconds;
        }

        function handleExpiredSession() {
            clearInterval(timerInterval);
            alert("Session expired!");
            localStorage.removeItem('omni_payment_pending');
            window.location.reload();
        }

        window.cancelAppPayment = function() {
            localStorage.removeItem('omni_payment_pending');
            localStorage.removeItem('omni_payment_method');
            localStorage.removeItem('omni_payment_expiry');
            clearInterval(timerInterval);
            window.location.reload();
        }

        window.verifyAndSubmitOrder = function(method) {
            const txnId = document.getElementById(method === 'qr' ? 'txn-id-qr' : 'txn-id-app').value;
            if(txnId.length < 8) { alert("Enter valid Transaction ID"); return; }
            finishOrder(txnId);
        }

        /* --- GOOGLE FORM SUBMISSION & HISTORY SAVING --- */
        window.finishOrder = function(txnId) {
            const orderId = 'ORD' + Math.floor(Math.random() * 1000000);
            let subtotal = 0;
            let itemsList = "";
            cart.forEach(item => {
                subtotal += item.price;
                itemsList += `${item.title} (₹${item.price}) | `;
            });
            
            const dynamicDelivery = getDynamicDeliveryCharge();
            const total = subtotal + dynamicDelivery + PLATFORM_FEE;
            const user = JSON.parse(localStorage.getItem('omni_user'));

            // SAVE DATA INCLUDING DYNAMIC CHARGE
            const history = JSON.parse(localStorage.getItem('omni_order_history')) || [];
            history.unshift({ 
                id: '#' + orderId, 
                date: new Date().toLocaleDateString(), 
                items: [...cart], 
                itemSubtotal: subtotal,
                delivery: dynamicDelivery, 
                platform: PLATFORM_FEE,   
                total: total, 
                status: "Processing" 
            });
            localStorage.setItem('omni_order_history', JSON.stringify(history));

            const formURL = "https://docs.google.com/forms/d/e/1FAIpQLSchH1TTV2xGTEKiZzsW2gk8ndIQThOC__J-x2n5-QQa7uTsBQ/formResponse";
            const body = new URLSearchParams();
            body.append("entry.1661471619", orderId);
            body.append("entry.1343328677", user.name);
            body.append("entry.1735888749", user.phone);
            body.append("entry.385864934", user.hostel);
            body.append("entry.665325514", itemsList);
            body.append("entry.344688394", total);
            body.append("entry.1266334251", txnId);

            fetch(formURL, {
                method: "POST",
                mode: "no-cors",
                headers: { "Content-Type": "application/x-www-form-urlencoded" },
                body: body.toString()
            }).then(() => {
                showSuccessScreen(user, orderId, subtotal, total, dynamicDelivery);
            }).catch(() => {
                showSuccessScreen(user, orderId, subtotal, total, dynamicDelivery);
            });
        }

        function showSuccessScreen(user, orderId, subtotal, total, deliveryCharge) {
            document.getElementById('inv-name').innerText = user.name;
            document.getElementById('inv-phone').innerText = user.phone;
            document.getElementById('inv-hostel').innerText = user.hostel;
            document.getElementById('inv-order-id').innerText = orderId;
            document.getElementById('inv-date').innerText = new Date().toLocaleDateString();
            document.getElementById('final-order-id').innerText = '#' + orderId;
            document.getElementById('success-bill-total').innerText = '₹' + total.toLocaleString();
            
            const successBillItems = document.getElementById('success-bill-items');
            successBillItems.innerHTML = '';
            const invItemsTable = document.getElementById('inv-items');
            invItemsTable.innerHTML = '';

            cart.forEach(item => {
                successBillItems.innerHTML += `<div class="os-item-row"><span>${item.title}</span><span>₹${item.price}</span></div>`;
                invItemsTable.innerHTML += `<tr><td>${item.title}</td><td>₹${item.price.toLocaleString()}</td></tr>`;
            });
            
            successBillItems.innerHTML += `<div class="os-item-row" style="border-top:1px dashed #444; margin-top:5px; padding-top:5px;"><span>Delivery Charge</span><span>₹${deliveryCharge}</span></div>`;
            successBillItems.innerHTML += `<div class="os-item-row"><span>Platform Fee</span><span>₹${PLATFORM_FEE}</span></div>`;
            
            document.getElementById('inv-subtotal').innerText = '₹' + subtotal.toLocaleString();
            document.getElementById('inv-total').innerText = '₹' + total.toLocaleString();

            // WHATSAPP BUTTON
            const successCard = document.querySelector('.success-card');
            if(!document.getElementById('wa-channel-btn')) {
                const waBtn = document.createElement('a');
                waBtn.id = 'wa-channel-btn';
                waBtn.href = 'https://whatsapp.com/channel/0029VaF69Xq42DcVwzY8mO0y'; // YOUR LINK
                waBtn.target = '_blank';
                waBtn.className = 'whatsapp-glow-btn';
                waBtn.innerHTML = '<i class="fab fa-whatsapp"></i> JOIN WHATSAPP CHANNEL FOR OFFERS';
                successCard.insertBefore(waBtn, document.querySelector('.download-btn'));
            }

            document.getElementById('checkout-modal').classList.remove('open');
            document.getElementById('order-success-screen').style.display = 'flex';
            cart = [];
            localStorage.removeItem('omni_cart');
            localStorage.removeItem('omni_payment_pending');
            updateCartUI();
        }

        window.downloadInvoice = function() { window.print(); }
        window.closeSuccessScreen = function() { window.location.reload(); }

        /* --- PROFILE & ORDER HISTORY --- */
        function openProfile() {
            document.getElementById('profile-modal').classList.add('open');
            loadProfileData(); 
        }
        function closeProfile() { document.getElementById('profile-modal').classList.remove('open'); }
        function showEditView() {
            document.getElementById('profile-main-menu').style.display = 'none';
            document.getElementById('profile-edit-view').style.display = 'block';
        }
        function showOrdersView() {
            document.getElementById('profile-main-menu').style.display = 'none';
            document.getElementById('profile-orders-view').style.display = 'block';
            renderOrderHistory();
        }
        function showMainView() {
            document.getElementById('profile-edit-view').style.display = 'none';
            document.getElementById('profile-orders-view').style.display = 'none';
            document.getElementById('profile-main-menu').style.display = 'block';
        }

        function renderOrderHistory() {
            const container = document.getElementById('orders-list-container');
            const history = JSON.parse(localStorage.getItem('omni_order_history')) || [];
            container.innerHTML = '';

            if (!history.length) {
                container.innerHTML = '<div style="text-align:center; padding:50px 20px; color:#888;"><i class="fas fa-shopping-bag" style="font-size:30px; margin-bottom:15px;"></i><p>No orders yet.</p></div>';
                return;
            }

            history.forEach((order, index) => {
                const itemNames = order.items.map(i => i.title).join(", ");
                const card = document.createElement('div');
                card.id = `history-card-${index}`;
                card.className = 'history-card';
                card.style = "background:#222; border-radius:15px; padding:15px; margin-bottom:15px; border:1px solid #333; transition: all 0.3s;";
                
                card.innerHTML = `
                    <div style="display:flex; justify-content:space-between; margin-bottom:10px;">
                        <span style="font-size:12px; color:#e6f014; font-weight:bold;">${order.id}</span>
                        <span style="font-size:11px; color:#888;">${order.date}</span>
                    </div>
                    <div style="display:flex; gap:12px; align-items:center; margin-bottom:12px;">
                        <img src="${order.items[0].imgSrc}" style="width:50px; height:50px; border-radius:8px; object-fit:cover;">
                        <div style="flex:1;">
                            <h4 style="font-size:13px; color:#fff; display:-webkit-box; -webkit-line-clamp:1; -webkit-box-orient:vertical; overflow:hidden;">${itemNames}</h4>
                            <p style="font-size:14px; color:#e6f014; font-weight:bold;">₹${order.total.toLocaleString()}</p>
                        </div>
                    </div>
                    <div style="display:flex; gap:10px;">
                        <button onclick="reorderItems(${index})" style="flex:1; padding:8px; background:#e6f014; color:#000; border:none; border-radius:6px; font-weight:bold; font-size:11px; cursor:pointer;">REORDER</button>
                        <button onclick="toggleHistoryDetails(${index})" style="flex:1; padding:8px; background:transparent; border:1px solid #444; color:#ccc; border-radius:6px; font-size:11px; cursor:pointer;">DETAILS</button>
                    </div>
                    <div id="history-details-${index}" style="display:none; margin-top:15px; padding-top:15px; border-top:1px dashed #444;">
                        <h5 style="color:#e6f014; font-size:11px; text-transform:uppercase; margin-bottom:10px; letter-spacing:1px;">Bill Summary</h5>
                        <div style="display:flex; justify-content:space-between; font-size:12px; color:#ccc; margin-bottom:5px;"><span>Item Total</span><span>₹${(order.itemSubtotal || 0).toLocaleString()}</span></div>
                        <div style="display:flex; justify-content:space-between; font-size:12px; color:#ccc; margin-bottom:5px;"><span>Delivery Charge</span><span>₹${(order.delivery || 40)}</span></div>
                        <div style="display:flex; justify-content:space-between; font-size:12px; color:#ccc; margin-bottom:10px;"><span>Platform Fee</span><span>₹${(order.platform || 5)}</span></div>
                        <div style="display:flex; justify-content:space-between; font-size:14px; color:#fff; font-weight:bold; border-top:1px solid #333; padding-top:8px;"><span>Grand Total</span><span style="color:#e6f014;">₹${order.total.toLocaleString()}</span></div>
                    </div>
                `;
                container.appendChild(card);
            });
        }

        window.toggleHistoryDetails = function(index) {
            const detailDiv = document.getElementById(`history-details-${index}`);
            detailDiv.style.display = detailDiv.style.display === "none" ? "block" : "none";
        }

        window.reorderItems = function(index) {
            const history = JSON.parse(localStorage.getItem('omni_order_history')) || [];
            const order = history[index];
            if (order && order.items) {
                cart = [...cart, ...order.items];
                localStorage.setItem('omni_cart', JSON.stringify(cart));
                updateCartUI();
                closeProfile();
                openCart();
                showToast();
            }
        }

        function loadProfileData() {
            const user = JSON.parse(localStorage.getItem('omni_user'));
            if(user) {
                document.getElementById('menu-user-name').innerText = user.name || "Guest";
                document.getElementById('p-name').value = user.name || "";
                document.getElementById('p-phone').value = user.phone || "";
                document.getElementById('p-hostel').value = user.hostel || "";
            }
        }
        function saveProfileData() {
            const user = { name: document.getElementById('p-name').value, phone: document.getElementById('p-phone').value, hostel: document.getElementById('p-hostel').value };
            localStorage.setItem('omni_user', JSON.stringify(user));
            alert("Profile Saved!");
            showMainView();
        }
        function clearProfileData() {
            if(confirm("Sign Out?")) {
                localStorage.removeItem('omni_user');
                window.location.reload();
            }
        }
    </script>
</body>
</html>
